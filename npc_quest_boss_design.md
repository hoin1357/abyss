# NPC 및 퀘스트 시스템 설계 문서

## 개요

'심연의 탐험가' 게임에서 NPC와 퀘스트는 게임의 세계관과 이야기를 풍부하게 만들고, 플레이어에게 추가적인 목표와 보상을 제공합니다. 이 문서는 게임에 등장하는 다양한 NPC와 퀘스트의 종류, 상호작용 방식, 보상 등을 상세히 설명합니다.

## NPC 시스템

### NPC 등장 방식

- 각 층마다 최소 1명의 이벤트 NPC가 등장합니다.
- NPC는 일반적으로 특별한 방(NPC 방)에 위치하며, 일부는 특정 조건을 만족해야 만날 수 있습니다.
- NPC는 대화, 거래, 퀘스트 제공, 정보 제공 등 다양한 상호작용을 제공합니다.
- 일부 NPC는 플레이어의 선택에 따라 태도나 제공하는 서비스가 변할 수 있습니다.

### NPC 유형

1. **퀘스트 NPC**: 플레이어에게 퀘스트를 제공하는 NPC
2. **상인 NPC**: 아이템을 판매하거나 구매하는 NPC
3. **정보 NPC**: 게임 세계관이나 힌트를 제공하는 NPC
4. **서비스 NPC**: 아이템 강화, 식별, 치유 등의 서비스를 제공하는 NPC
5. **적대적 NPC**: 특정 조건에서 적으로 변하는 NPC

### NPC 상호작용 시스템

- **대화 시스템**: 텍스트 기반 대화 인터페이스를 통해 NPC와 대화
- **선택지 시스템**: 플레이어의 선택에 따라 대화와 결과가 분기
- **평판 시스템**: 일부 NPC는 플레이어의 행동에 따라 호감도가 변화
- **조건부 대화**: 특정 아이템 소지, 퀘스트 진행 상태, 플레이어 직업 등에 따라 다른 대화 옵션 제공

## 퀘스트 시스템

### 퀘스트 유형

1. **수집 퀘스트**: 특정 아이템을 수집하여 NPC에게 전달
2. **처치 퀘스트**: 특정 적을 처치하고 증거를 가져오기
3. **탐험 퀘스트**: 특정 장소를 찾아 정보 수집
4. **호위 퀘스트**: NPC를 특정 위치까지 안전하게 호위
5. **퍼즐 퀘스트**: 특정 퍼즐이나 문제 해결
6. **선택 퀘스트**: 여러 결말이 있는 도덕적 선택이 필요한 퀘스트

### 퀘스트 진행 방식

- **퀘스트 수락**: NPC와의 대화를 통해 퀘스트 수락
- **퀘스트 로그**: 현재 진행 중인 퀘스트 목록과 상태 확인
- **퀘스트 마커**: 퀘스트 관련 위치나 대상을 미니맵에 표시
- **퀘스트 완료**: 조건 충족 후 NPC에게 돌아가 보상 수령
- **퀘스트 실패**: 일부 퀘스트는 시간 제한이나 특정 조건 미충족 시 실패 가능

### 퀘스트 보상 시스템

- **아이템 보상**: 무기, 방어구, 소비 아이템 등
- **골드 보상**: 게임 내 화폐
- **경험치 보상**: 레벨업을 위한 경험치
- **스킬 포인트 보상**: 스킬 트리에 사용할 수 있는 포인트
- **특수 능력 보상**: 특별한 능력이나 패시브 효과
- **NPC 서비스 보상**: 상점 할인, 특별 아이템 판매 등

## 층별 NPC 및 퀘스트

### 하수도 (1-3층)

#### 1. 하수도 관리인 (2층)

**위치**: 하수도 관리실

**외형**: 나이 든 남성, 작업복과 장갑 착용, 지팡이 사용

**성격**: 꼼꼼하고 책임감 있음, 하수도 시스템에 대한 자부심이 강함

**상호작용**:
- **대화**: 하수도의 역사와 현재 상태에 대한 정보 제공
- **퀘스트**: "오염된 물길" - 하수도의 오염원을 찾아 제거하는 퀘스트
- **서비스**: 하수도 지도 제공 (미니맵 기능 강화)

**퀘스트 상세**:
- **목표**: 오염된 물길의 원인인 슬라임 둥지 찾기 및 정화 크리스탈 설치
- **보상**: 방수 부츠 (물 속에서 이동 속도 감소 없음), 하수도 지도

#### 2. 도둑 (1층)

**위치**: 하수도 입구 근처 숨겨진 방

**외형**: 후드를 쓴 날렵한 인물, 다양한 도구를 소지

**성격**: 의심이 많고 경계심 강함, 이익을 중시

**상호작용**:
- **대화**: 도시의 소문과 비밀에 대한 정보 제공
- **퀘스트**: "잃어버린 보물" - 도둑이 잃어버린 귀중품 찾기
- **거래**: 특별한 아이템 판매 (열쇠, 도둑 도구 등)

**퀘스트 상세**:
- **목표**: 하수도 3층에 있는 쥐 둥지에서 도둑의 부적 찾기
- **보상**: 도둑의 단검 (크리티컬 확률 증가), 도둑 기술 (숨겨진 문 발견 확률 증가)

#### 3. 연금술사 (3층)

**위치**: 비밀 연구실

**외형**: 화려한 로브를 입은 중년 여성, 다양한 물약과 재료를 소지

**성격**: 호기심 많고 실험을 좋아함, 약간 산만함

**상호작용**:
- **대화**: 포션과 연금술에 대한 정보 제공
- **퀘스트**: "희귀 재료 수집" - 특별한 연금술 재료 수집
- **서비스**: 포션 제작 및 판매

**퀘스트 상세**:
- **목표**: 하수도 곳곳에서 5가지 희귀 재료 수집 (빛나는 이끼, 특수 광물 등)
- **보상**: 연금술사의 포션 (임시 능력치 대폭 증가), 포션 제작 레시피

### 광산 (3-6층)

#### 1. 광부 대장 (4층)

**위치**: 광산 캠프

**외형**: 근육질의 드워프, 헬멧과 곡괭이 소지

**성격**: 직설적이고 강인함, 부하들에 대한 책임감이 강함

**상호작용**:
- **대화**: 광산의 역사와 위험에 대한 정보 제공
- **퀘스트**: "무너진 통로" - 무너진 광산 통로 복구
- **서비스**: 광산 지도 제공, 채광 도구 판매

**퀘스트 상세**:
- **목표**: 무너진 통로를 막고 있는 바위 괴물 처치 및 지지대 설치
- **보상**: 광부의 곡괭이 (광물에 추가 데미지), 광산 지도

#### 2. 발명가 (6층)

**위치**: 기계 작업실

**외형**: 안경을 쓴 마른 체형의 노인, 다양한 도구와 장치를 소지

**성격**: 창의적이고 열정적, 새로운 아이디어에 흥분함

**상호작용**:
- **대화**: 기계 장치와 발명품에 대한 정보 제공
- **퀘스트**: "완벽한 부품" - 특수 기계 부품 수집
- **서비스**: 장비 강화 및 특수 아이템 제작

**퀘스트 상세**:
- **목표**: 광산 곳곳에서 3가지 특수 기계 부품 수집
- **보상**: 자동 채광 장치 (주변 광물 자동 표시), 무기 강화 서비스

#### 3. 잃어버린 탐험가 (5층)

**위치**: 막다른 동굴

**외형**: 부상당한 젊은 탐험가, 찢어진 옷과 빈 가방

**성격**: 두렵고 혼란스러움, 도움에 감사함

**상호작용**:
- **대화**: 심연의 더 깊은 층에 대한 정보 제공
- **퀘스트**: "안전한 귀환" - 탐험가를 출구까지 호위
- **보상**: 탐험가의 지도 (다음 층의 일부 정보 미리 공개)

**퀘스트 상세**:
- **목표**: 탐험가를 광산 입구까지 안전하게 호위 (적 3파티 처치)
- **보상**: 탐험가의 부적 (미지 지역 탐험 시 발견 범위 증가), 심해에 대한 정보

### 신비한 심해 (7-9층)

#### 1. 해양 생물학자 (8층)

**위치**: 수중 연구소

**외형**: 방수 슈트를 입은 중년 여성, 연구 장비와 기록 도구 소지

**성격**: 분석적이고 냉정함, 지식에 대한 열망이 강함

**상호작용**:
- **대화**: 심해 생물과 환경에 대한 정보 제공
- **퀘스트**: "심해 생태계 연구" - 심해 생물 표본 수집
- **서비스**: 심해 생물 약점 정보 제공

**퀘스트 상세**:
- **목표**: 다양한 심해 생물의 표본 5개 수집
- **보상**: 심해 생물 도감 (모든 심해 생물의 약점 공개), 수중 호흡 물약

#### 2. 고대 신전 수호자 (7층)

**위치**: 물의 신전

**외형**: 빛나는 갑옷을 입은 인어 형상의 존재

**성격**: 의무감이 강하고 엄격함, 신전에 대한 헌신적 태도

**상호작용**:
- **대화**: 물의 신과 신전의 역사에 대한 정보 제공
- **퀘스트**: "신성한 정화" - 오염된 신전 정화
- **서비스**: 물 속성 강화 및 축복

**퀘스트 상세**:
- **목표**: 신전 내 3개의 오염된 제단 정화 및 침입한 어둠의 생물 처치
- **보상**: 물의 축복 (물 속성 공격력/저항력 영구 증가), 신전 비밀 입장권

#### 3. 난파선 선장 (9층)

**위치**: 난파된 배의 선실

**외형**: 수염이 긴 노인 선장, 낡은 선장 복장과 나침반 소지

**성격**: 고집스럽고 자존심 강함, 과거에 집착

**상호작용**:
- **대화**: 심연의 비밀과 전설에 대한 정보 제공
- **퀘스트**: "잃어버린 선원들" - 실종된 선원 찾기
- **보상**: 선장의 나침반 (숨겨진 보물 위치 표시)

**퀘스트 상세**:
- **목표**: 심해 곳곳에 흩어진 선원 3명 찾기 (일부는 이미 사망)
- **보상**: 심연의 지도 (최종 층의 일부 정보 미리 공개), 선장의 비밀 열쇠

### 최종 심연 (10층)

#### 1. 고대 현자 (10층)

**위치**: 숨겨진 도서관

**외형**: 빛나는 로브를 입은 노인, 고대 서적과 마법 지팡이 소지

**성격**: 지혜롭고 신중함, 심연의 비밀을 지키는 수호자

**상호작용**:
- **대화**: 최종 보스와 심연의 진실에 대한 정보 제공
- **퀘스트**: "고대의 지식" - 잃어버린 마법서 페이지 수집
- **서비스**: 최종 전투를 위한 준비 및 강화

**퀘스트 상세**:
- **목표**: 10층 곳곳에 흩어진 고대 마법서 페이지 7장 수집
- **보상**: 심연의 비밀 (최종 보스의 약점 공개), 현자의 축복 (모든 능력치 증가)

#### 2. 타락한 탐험가 (10층)

**위치**: 심연의 제단 근처

**외형**: 심연의 힘에 오염된 탐험가, 어둠의 기운이 감도는 갑옷과 무기

**성격**: 광기에 사로잡힘, 심연의 힘을 숭배

**상호작용**:
- **대화**: 왜곡된 심연의 진실과 자신의 타락 과정 설명
- **선택**: 그를 처치하거나 동맹을 맺는 선택
- **결과**: 처치 시 - 정화된 장비 획득, 동맹 시 - 최종 보스전 지원 (하지만 배신 가능성)

**퀘스트/선택 상세**:
- **목표**: 타락한 탐험가의 운명 결정 (처치 또는 동맹)
- **보상**: 처치 시 - 정화된 심연의 갑옷 (모든 속성 저항), 동맹 시 - 심연의 표식 (최종 보스 첫 공격 회피)

## 중간 보스 및 최종 보스

### 중간 보스 1: 하수도 왕 (3층)

**위치**: 하수도 최하층 특수 방

**외형**: 거대한 쥐와 슬라임이 합쳐진 형태, 녹색 독성 물질이 흘러나옴

**패턴**:
1. **독성 분출**: 전방 3칸에 독성 물질 분출 (2턴마다 사용, 공격 전 바닥에 경고 표시)
2. **쥐 소환**: 일반 쥐 3-5마리 소환 (체력 50% 이하일 때 사용)
3. **맹독 돌진**: 직선으로 돌진하며 독성 흔적 남김 (체력 30% 이하일 때 사용, 공격 전 방향 표시)
4. **재생**: 턴마다 최대 체력의 1% 회복 (지속적 패시브)

**약점**: 불 속성 (25% 추가 피해), 독 면역

**보상**: 하수도 왕의 이빨 (독 속성 무기 제작 재료), 정화의 물약 (모든 상태이상 제거)

### 중간 보스 2: 광산 골렘 (6층)

**위치**: 광산 최하층 특수 방

**외형**: 다양한 광물과 기계 부품으로 이루어진 거대한 골렘

**패턴**:
1. **지진 충격**: 주변 3x3 범위에 지진 공격 (3턴마다 사용, 공격 전 바닥에 균열 표시)
2. **광물 발사**: 원거리에서 다양한 광물 발사 (2턴마다 사용, 공격 전 조준선 표시)
3. **철벽 모드**: 방어력 크게 증가, 이동 불가 (체력 40% 이하일 때 사용, 3턴 지속)
4. **자가 수리**: 주변 광물을 흡수해 체력 회복 (체력 20% 이하일 때 사용)

**약점**: 번개 속성 (30% 추가 피해), 물리 공격 저항

**보상**: 골렘의 핵 (장비 강화 재료), 지진의 망치 (지면 충격 특수 공격 가능한 무기)

### 최종 보스: 심연의 대뱀 (10층)

**위치**: 심연의 최종 방

**외형**: 거대한 뱀 형태의 고대 존재, 여러 원소의 기운이 몸에서 소용돌이침

**패턴**:
1. **원소 브레스**: 전방 넓은 범위에 현재 속성의 브레스 공격 (3턴마다 사용, 공격 전 입 벌리는 모션과 바닥에 경고 표시)
2. **속성 변환**: 5가지 속성(불, 얼음, 번개, 독, 자연) 중 하나로 변환 (4턴마다 사용, 변환 시 해당 속성 공격력 증가 및 저항력 획득)
3. **분신 소환**: 작은 뱀 분신 3-4마리 소환 (체력 70%, 40% 구간에서 사용)
4. **대지진**: 전체 방에 지진 공격, 일부 지형 변화 (체력 30% 이하일 때 사용, 공격 전 전체 방 진동)
5. **포식**: 대상을 집어삼켜 큰 피해와 상태이상 부여 (체력 50% 이하일 때 사용, 공격 전 목표 지정 표시)
6. **재생**: 분신 처치 시마다 체력 회복 (분신당 최대 체력의 5%)

**약점**: 
- 현재 속성의 상성 속성에 취약 (50% 추가 피해)
- 속성 변환 중에 잠시 모든 피해 25% 증가

**보상**: 
- 심연의 비늘 (최고급 방어구 제작 재료)
- 뱀신의 이빨 (모든 속성 공격이 가능한 전설급 무기)
- 게임 클리어 및 엔딩

## 퀘스트 시스템 구현 가이드라인

### 퀘스트 데이터 구조

```javascript
{
    id: "unique_quest_id",
    name: "퀘스트 이름",
    description: "퀘스트 설명",
    giver: "npc_id",
    type: "collection", // collection, kill, explore, escort, puzzle, choice
    requirements: {
        level: 5, // 최소 레벨
        quests: ["previous_quest_id"], // 선행 퀘스트
        items: ["required_item_id"], // 필요 아이템
        floor: 3 // 최소 층
    },
    objectives: [
        {
            type: "collect",
            target: "item_id",
            count: 5,
            current: 0,
            description: "아이템 5개 수집"
        },
        {
            type: "kill",
            target: "enemy_id",
            count: 3,
            current: 0,
            description: "적 3마리 처치"
        }
    ],
    rewards: [
        {
            type: "item",
            id: "reward_item_id",
            count: 1
        },
        {
            type: "gold",
            amount: 500
        },
        {
            type: "exp",
            amount: 1000
        }
    ],
    state: "available", // available, active, completed, failed
    timeLimit: 0, // 0은 제한 없음, 초 단위
    choices: [] // 선택 퀘스트인 경우 선택지 배열
}
```

### 퀘스트 UI 요소

1. **퀘스트 로그**: 현재 진행 중인 퀘스트 목록과 상태 표시
2. **퀘스트 상세 정보**: 선택한 퀘스트의 상세 정보, 목표, 보상 표시
3. **퀘스트 마커**: 미니맵과 게임 화면에 퀘스트 관련 위치 표시
4. **퀘스트 알림**: 퀘스트 진행 상태 변화 시 알림 표시
5. **대화 인터페이스**: NPC와의 대화 및 퀘스트 수락/완료 인터페이스

### NPC 상호작용 구현

1. **대화 시스템**: 텍스트 기반 대화창과 선택지 표시
2. **조건부 대화**: 플레이어 상태, 아이템, 퀘스트 진행도에 따른 다른 대화 분기
3. **NPC 상태 관리**: NPC의 위치, 상태, 제공 서비스 등 관리
4. **NPC 반응**: 플레이어 행동에 따른 NPC 반응 및 관계 변화

## 결론

NPC와 퀘스트 시스템은 '심연의 탐험가' 게임에 이야기와 목표를 부여하는 중요한 요소입니다. 각 층별로 특색 있는 NPC와 퀘스트를 배치하여 게임의 세계관을 풍부하게 만들고, 플레이어에게 다양한 도전과 보상을 제공합니다. 중간 보스와 최종 보스는 게임의 주요 도전 요소로, 전략적인 전투와 긴장감을 제공하며, 각 보스는 독특한 패턴과 약점을 가지고 있어 플레이어의 전략적 접근을 요구합니다.
